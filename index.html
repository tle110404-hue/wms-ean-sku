<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>WMS Mini â€“ EAN & SKU</title>

<script src="https://unpkg.com/html5-qrcode"></script>

<style>
body{font-family:Arial;background:#f4f6f8;padding:20px}
.box{background:#fff;padding:15px;margin-bottom:20px;border-radius:6px}
h2{color:#2c3e50}
input,select,button{padding:8px;width:100%;margin:5px 0}
button{background:#3498db;color:#fff;border:none;cursor:pointer}
button:hover{background:#2980b9}
table{width:100%;border-collapse:collapse}
th,td{border:1px solid #ccc;padding:8px;text-align:center}
.hidden{display:none}
#reader{width:100%}
</style>
</head>

<body>

<h1>ğŸ“¦ WMS Mini â€“ Äá»“ Ã¡n Quáº£n lÃ½ kho</h1>

<!-- LOGIN -->
<div class="box" id="loginBox">
<h2>ğŸ” ÄÄƒng nháº­p</h2>
<input id="user" placeholder="Username">
<input id="pass" type="password" placeholder="Password">
<button onclick="login()">Login</button>
</div>

<!-- MAIN -->
<div id="main" class="hidden">

<p><b>Vai trÃ²:</b> <span id="role"></span></p>

<!-- STEP 1 -->
<div class="box admin">
<h2>1ï¸âƒ£ Nháº­n diá»‡n sáº£n pháº©m (QuÃ©t EAN)</h2>
<input id="ean">
<button onclick="scanEAN()">ğŸ“· QuÃ©t EAN</button>
<input id="pname" placeholder="TÃªn sáº£n pháº©m">
<button onclick="saveProduct()">LÆ°u sáº£n pháº©m</button>
<div id="reader"></div>
</div>

<!-- STEP 2 -->
<div class="box admin">
<h2>2ï¸âƒ£ Táº¡o SKU ná»™i bá»™</h2>
<input id="sku">
<input id="skuEAN" placeholder="EAN liÃªn káº¿t">
<button onclick="createSKU()">Táº¡o SKU</button>
</div>

<!-- STEP 3 -->
<div class="box">
<h2>3ï¸âƒ£ Nháº­p kho (SKU â†’ Location)</h2>
<input id="skuIn" placeholder="SKU">
<input id="location" placeholder="Vá»‹ trÃ­ kho (VD: A-01-02)">
<input id="qtyIn" type="number" placeholder="Sá»‘ lÆ°á»£ng">
<button onclick="stockIn()">XÃ¡c nháº­n nháº­p kho</button>
</div>

<!-- PICK LIST -->
<div class="box admin">
<h2>4ï¸âƒ£ Táº¡o lá»‡nh xuáº¥t (Pick List)</h2>
<input id="pickSKU" placeholder="SKU">
<input id="pickQty" type="number" placeholder="Sá»‘ lÆ°á»£ng">
<button onclick="createPick()">Táº¡o Pick List</button>
</div>

<!-- OUTBOUND -->
<div class="box">
<h2>5ï¸âƒ£ Xuáº¥t kho (QuÃ©t EAN â†’ Map SKU)</h2>
<input id="outEAN" placeholder="QuÃ©t EAN xuáº¥t">
<button onclick="scanOutEAN()">ğŸ“· QuÃ©t EAN</button>
<button onclick="confirmOut()">XÃ¡c nháº­n xuáº¥t kho</button>
</div>

<!-- INVENTORY -->
<div class="box">
<h2>ğŸ“Š Tá»“n kho</h2>
<table>
<thead>
<tr><th>EAN</th><th>SKU</th><th>Vá»‹ trÃ­</th><th>Tá»“n</th></tr>
</thead>
<tbody id="inventory"></tbody>
</table>
</div>

</div>

<script>
/* USERS */
let users={admin:{pass:"123",role:"Admin"},staff:{pass:"123",role:"Staff"}};
let currentRole="";

/* DATA */
let products=JSON.parse(localStorage.getItem("products"))||{};
let skus=JSON.parse(localStorage.getItem("skus"))||{};
let inventoryData=JSON.parse(localStorage.getItem("inventory"))||[];
let pickList=null;

/* LOGIN */
function login(){
 if(users[user.value]&&users[user.value].pass===pass.value){
  currentRole=users[user.value].role;
  loginBox.classList.add("hidden");
  main.classList.remove("hidden");
  role.innerText=currentRole;
  if(currentRole==="Staff"){
    document.querySelectorAll(".admin").forEach(e=>e.remove());
  }
  render();
 } else alert("Sai tÃ i khoáº£n");
}

/* SAVE */
function save(){
 localStorage.setItem("products",JSON.stringify(products));
 localStorage.setItem("skus",JSON.stringify(skus));
 localStorage.setItem("inventory",JSON.stringify(inventoryData));
 render();
}

/* STEP 1 */
function scanEAN(){
 const qr=new Html5Qrcode("reader");
 qr.start({facingMode:"environment"}, {},
  t=>{ean.value=t;qr.stop();}, e=>{}
 );
}
function saveProduct(){
 if(!ean.value||!pname.value) return alert("Thiáº¿u thÃ´ng tin");
 products[ean.value]=pname.value;
 save();
}

/* STEP 2 */
function createSKU(){
 if(!products[skuEAN.value]) return alert("EAN chÆ°a tá»“n táº¡i");
 skus[sku.value]=skuEAN.value;
 save();
}

/* STEP 3 */
function stockIn(){
 if(!skus[skuIn.value]) return alert("SKU chÆ°a tá»“n táº¡i");
 inventoryData.push({
  ean:skus[skuIn.value],
  sku:skuIn.value,
  location:location.value,
  qty:Number(qtyIn.value)
 });
 save();
}

/* PICK */
function createPick(){
 pickList={sku:pickSKU.value,qty:Number(pickQty.value)};
 alert("ÄÃ£ táº¡o pick list");
}

/* OUTBOUND */
function scanOutEAN(){
 const qr=new Html5Qrcode("reader");
 qr.start({facingMode:"environment"}, {},
  t=>{outEAN.value=t;qr.stop();}, e=>{}
 );
}

function confirmOut(){
 if(!pickList) return alert("ChÆ°a cÃ³ pick list");
 let skuFound=Object.keys(skus).find(s=>skus[s]===outEAN.value);
 if(skuFound!==pickList.sku) return alert("Sai SKU");
 let item=inventoryData.find(i=>i.sku===skuFound);
 if(!item||item.qty<pickList.qty) return alert("KhÃ´ng Ä‘á»§ tá»“n");
 item.qty-=pickList.qty;
 pickList=null;
 save();
 alert("Xuáº¥t kho thÃ nh cÃ´ng");
}

/* RENDER */
function render(){
 inventory.innerHTML="";
 inventoryData.forEach(i=>{
  inventory.innerHTML+=`
  <tr>
   <td>${i.ean}</td>
   <td>${i.sku}</td>
   <td>${i.location}</td>
   <td>${i.qty}</td>
  </tr>`;
 });
}
render();
</script>

</body>
</html>
